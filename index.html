<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Lander One</title>


  <script src='https://code.jquery.com/jquery-2.2.1.min.js'></script>
  
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="css/style.css">


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  	
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

  
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
  

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 


 
</head>
<body>
  <div class="header">
    <div class="row">
      <div class="col-md-12">
        <div class="text-center top-title">Live Cam Invite</div>
      </div>
    </div>
  </div>






	
<style type="text/css">
@import url('https://fonts.gstatic.com');
@import url('https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i');
@import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@300&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap');


.mytext{
    border:0;padding:10px;background:whitesmoke;
}
.text{
	display:flex;flex-direction:column;
	font-family: 'Open Sans', sans-serif;
}
.text > p:first-of-type{
    width:100%;margin-top:0;margin-bottom:auto;line-height: 13px;    font-size: 1.2em;;
}
.text > p:last-of-type{
    width: 100%;
    color: #000;
    margin-bottom: -7px;
    padding-top: 9px;
	line-height: 1;
}
.text-l{
    float:left;padding-right:10px;
}        
.text-r{
	float:right;padding-left:10px;
      
}

.text-right{
 float: right;
    padding-left: 1px;
    padding-bottom: 18px;
}
.text-left{
 float: left;
    padding-left: 1px;
    padding-bottom: 18px;
}

.avatar{
    display:flex;
    justify-content:center;
    align-items:center;
    width:25%;
    float:left;
    padding-right:10px;
}

.avatar_you{
       display: inline-block;
    /* justify-content: center; */
    /* align-items: center; */
    width: 50px;
    /* float: right; */
    /* padding-right: 10px; */
    /* position: absolute; */
    float: right;
}

.avatar_me{
       display: inline-block;
    /* justify-content: center; */
    /* align-items: center; */
    width: 50px;
    /* float: right; */
    /* padding-right: 10px; */
    /* position: absolute; */
    float: left;
}





.macro{
    margin-top:5px;width: 83%;border-radius:5px;padding:5px;display:flex;
}

.msg-rta{
    background: #E6F8F1;
    display: inline-flex;
    /* border: 1px solid; */
    width: 83%;
    margin-top: 2px;
}

.msg-lta{
    background: #E6F8F1;
    display: inline-flex;
    /* border: 1px solid; */
    width: 83%;
    margin-top: 2px;
}


.msj-rta{
    float:right;background:whitesmoke;
}



.msj{
    float:left;background:white;
}
.frame{
    background: #e0e0de;
    height: 450px;
    overflow: hidden;
    padding: 0;
    border: 1px solid red;
    position: fixed;
    /* left: 0; */
    right: 60px;
    border: 0;
    bottom: 0;
	border-radius: 10px 10px 0px 0px;
}
.frame > div:last-of-type{
    position:absolute;bottom:0;width:100%;display:flex;
}
body > div > div > div:nth-child(2) > span{
    background: whitesmoke;padding: 10px;font-size: 21px;border-radius: 50%;
}
body > div > div > div.msj-rta.macro{
    margin:auto;margin-left:1%;
}
ul {
    width:100%;
    list-style-type: none;
    padding:18px;
    position:absolute;
    bottom:47px;
    display:flex;
    flex-direction: column;
    top:0;
    overflow-y:scroll;
}
.msj:before{
    width: 0;
    height: 0;
    content:"";
    top:-5px;
    left:-14px;
    position:relative;
    border-style: solid;
    border-width: 0 13px 13px 0;
    border-color: transparent #ffffff transparent transparent;            
}
.msj-rta:after{
    width: 0;
    height: 0;
    content:"";
    top:-5px;
    left:14px;
    position:relative;
    border-style: solid;
    border-width: 13px 13px 0 0;
    border-color: whitesmoke transparent transparent transparent;           
}  
input:focus{
    outline: none;
}        
::-webkit-input-placeholder { /* Chrome/Opera/Safari */
    color: #d4d4d4;
}
::-moz-placeholder { /* Firefox 19+ */
    color: #d4d4d4;
}
:-ms-input-placeholder { /* IE 10+ */
    color: #d4d4d4;
}
:-moz-placeholder { /* Firefox 18- */
    color: #d4d4d4;
} 

.msg_header{
	border: 1px solid #ccc;
    width: 100%;
    height: 10%;
    margin-bottom: 90px;
    border-bottom: none;
    display: inline-block;
    background-color: #007bff;
    display: relative;
    border-radius: 10px 10px 0px 0px;
} 

.msg_header_img img{
	border-radius: 50%;
    /* width: 40px; */
    margin-left: 2%;
    margin-top: 3px;
    width: 40px;
    height: 40px;
	
}

.chat_up {
    margin-top: 68px;
}


 .chat-bubble {
  background-color:#E6F8F1;
  padding:16px 28px;
  -webkit-border-radius: 20px;
  -webkit-border-bottom-left-radius: 2px;
  -moz-border-radius: 20px;
  -moz-border-radius-bottomleft: 2px;
  border-radius: 20px;
  border-bottom-left-radius: 2px;
  display:inline-block;
}
.typing {
  align-items: center;
  display: flex;
  height: 17px;
}
.typing .dot {
  animation: mercuryTypingAnimation 1.8s infinite ease-in-out;
  background-color: #6CAD96 ; //rgba(20,105,69,.7);
  border-radius: 50%;
  height: 7px;
  margin-right: 4px;
  vertical-align: middle;
  width: 7px;
  display: inline-block;
}
.typing .dot:nth-child(1) {
  animation-delay: 200ms;
}
.typing .dot:nth-child(2) {
  animation-delay: 300ms;
}
.typing .dot:nth-child(3) {
  animation-delay: 400ms;
}
.typing .dot:last-child {
  margin-right: 0;
}

@keyframes mercuryTypingAnimation {
  0% {
    transform: translateY(0px);
    background-color:#6CAD96; // rgba(20,105,69,.7);
  }
  28% {
    transform: translateY(-7px);
    background-color:#9ECAB9; //rgba(20,105,69,.4);
  }
  44% {
    transform: translateY(0px);
    background-color: #B5D9CB; //rgba(20,105,69,.2);
  }
}


.avatar_name{
	color: white;
	font-family: 'Ubuntu', sans-serif;
}

.list_item{
  width:100%; display: inline-block; margin-top: 5px
}

.minimize_btn{ 
    position: relative;
    float: right;
       padding: 3px;
}

.close{
 font-size: 37px;

    color: #ffffff;
}

    </style>

	
	  <div class="col-sm-10 col-xs-10 col-md-4 col-lg-3  frame">
			<div class="msg_header">
				<div class="msg_header_img">
					<img src="http://localhost/webchat/public/storage/campaign_avatar/1615976018.jpg" width="40px" height="40px"> <span id="avatar_name" class="avatar_name">Samantha Sathia</span>
					
					<div class="minimize_btn" id="minimize_btn">
						<button type="button" class="close" aria-label="Close">
						<span aria-hidden="true">&times;</span>
						</button>
					</div>
				</div>
			</div>
				
				<ul class="chat_up">
				</ul>
					
            <div>
                <div class="msj-rta macro">    
					<!--<span class="fa fa-paperclip"></span>-->				
                    <div class="text text-r" style="background:whitesmoke !important; display: inline-block">
                      <input class="mytext" placeholder="Type a message"/>
                    </div> 
                </div>
                <div style="padding:3px; display: inline-flex" >
                     <span class="fa fa-paper-plane" id="send_icon"></span>
                </div>                
            </div>
        </div> 

<script type="text/javascript">
var base_url = "http://localhost/webchat";
var api_key = "YjVhfhFisIQgihUr";
var typing_status = false;
if(localStorage.getItem("guest_session")==null){
	localStorage.setItem("guest_session", Date.now());
}

var session = localStorage.getItem("guest_session");

var me = {};
me.avatar = "http://localhost/webchat/public/storage/campaign_avatar/1615976018.jpg";

var you = {};
you.avatar = "image/chatavatar.png"; 


// Extra Info
	var client_data = {os_name:null,os_version:null,browser_name:null,browser_version:null,user_agent:null,user_ip:null,user_state:null,user_city:null,user_region:null,user_country:null,lat:null,lon:null};

// Start the chat as new or check existing //
 setTimeout(
        function(){	
           startChat(api_key);
        }, 5000);
		
var intervalId = window.setInterval(function(){
  receiveAIMessage(api_key);
}, 15000);		
		

function formatAMPM(date) {
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0'+minutes : minutes;
    var strTime = hours + ':' + minutes + ' ' + ampm;
    return strTime;
}            


$(".mytext").on("keydown", function(e){
    if (e.which == 13){
        var text = $(this).val();
        if (text !== ""){
			sendUserMessage(api_key,text)            
            $(this).val('');
        }
    }
});

$("#send_icon").on("click", function(e){
    
	var text = $(".mytext").val();
	if (text !== ""){
		sendUserMessage(api_key,text)            
		$(".mytext").val('');
	}
   
});

// For starting only
function startChat(api_key=null) {
	
	var postdata = {'api_key':api_key,'session':session,'message':'start','client_data':client_data};

			$.ajax({
			   type:'POST',
			   url:base_url+'/api/v1/chatstart',
			   data:postdata,
			   success:function(data) {
					
				console.log(data);

			   }
			});	
	
}

// For starting only
function loadConversaton(api_key=null) {
	var control = "";
	var postdata = {'api_key':api_key,'session':session,'message':'load_conversation'};

			$.ajax({
			   type:'POST',
			   url:base_url+'/api/v1/loadMessage',
			   data:postdata,
			   success:function(data) {
					var all_message ="";
					$.each(data.response.message, function(k, v) {
						if(v.type=='outgoing'){
								all_message += '<li class="list_item">' +
												'<div class="avatar"><img class="img-circle" width="40px" height="40px" src="'+ me.avatar +'" /></div>' +
												'<div class="msj macro">' +
												
													'<div class="text text-l">' +
														'<p>'+ v.message +'</p>' +
													'</div>' +
												'</div>' +
											'</li>';
						
						}else if(v.type=='incoming'){
								all_message +=  '<li class="list_item">' +
													'<div class="msg-rta macro">' +
														'<div class="text text-right">' +
															'<p>'+v.message +'</p>' +
														'</div>' + 
													'</div>' + 
													'<div class="avatar_you"><img class="img-circle"  width="40px" height="40px" src="'+ you.avatar +'" /></div>' +									
											  '</li>';	
						
						}
					});
				$("ul").append(all_message).scrollTop($("ul").prop('scrollHeight'));	
			   }
			});	
	
}

// For Conversation
function sendUserMessage(api_key=null,user_message) {
    var control = "";
    var date = formatAMPM(new Date());
	var postdata = {'api_key':api_key,'session':session,'message':user_message};
			$.ajax({
			   type:'POST',
			   url:base_url+'/api/v1/receiveMessage',
			   data:postdata,
			   success:function(data) {
					
				return 	data;

			   }
			});

		control = '<li class="list_item">' +
                        '<div class="msg-rta macro">' +
                            '<div class="text text-right">' +
                                '<p>'+user_message+'</p>' +
                            '</div>' + 
                        '</div>' + 
						'<div class="avatar_you"><img class="img-circle"  width="40px" height="40px" src="'+ you.avatar +'" /></div>' +									
                  '</li>';	
				  
	 $("ul").append(control).scrollTop($("ul").prop('scrollHeight'));			  
	
}

// For Conversation
function receiveAIMessage(api_key=null) {
    var date = formatAMPM(new Date());
	var control = "";
	var postdata = {'api_key':api_key,'session':session};
		
	var chat_bubble = '<div class="chat-bubble" id="chat_bubble">'+
							'<div class="typing">'+ 
								'<div class="dot"></div>'+
								'<div class="dot"></div>'+
								'<div class="dot"></div>'+
							'</div>'+
						'</div>';
	
		

			$.ajax({
			   type:'POST',
			   url:base_url+'/api/v1/sendMessage',
			   data:postdata,
			   success:function(data) {	

				var message = data.response.message ;

				
					if(message!='sent'){
					
						if(message=='Typing'){
							if(typing_status==false){
							
								control = '<li style="width:100%  display: inline-block"">' +
											'<div class="avatar"><img class="img-circle"  width="40px" height="40px" src="'+ me.avatar +'" /></div>' +
											'<div class="">' +
												'<div class="text text-l">' +
													'<p>'+ chat_bubble +'</p>' +
												'</div>' +
											'</div>' +
										'</li>';
			   
						
								$("ul").append(control).scrollTop($("ul").prop('scrollHeight'));
								
								typing_status = true;
							}
						}else{
						
							typing_status = false;
							$("#chat_bubble").parents('li').remove();
							
								control = '<li class="list_item">'+ 
											'<div class="avatar_me"><img class="img-circle"  width="40px" height="40px" src="'+ me.avatar +'" /></div>' +
												'<div class="msg-lta macro">' +
													'<div class="text text-left">' +
														'<p>'+message+'</p>' +
													'</div>' + 
												'</div>' + 										
										  '</li>';	
			   
						
							
							$("ul").append(control).scrollTop($("ul").prop('scrollHeight'));
								
						}
				
					}	
				}
			});	
				
					
}
</script>



<script>

(function () {
    'use strict';
    
    var module = {
        options: [],
        header: [navigator.platform, navigator.userAgent, navigator.appVersion, navigator.vendor, window.opera],
        dataos: [
            { name: 'Windows Phone', value: 'Windows Phone', version: 'OS' },
            { name: 'Windows', value: 'Win', version: 'NT' },
            { name: 'iPhone', value: 'iPhone', version: 'OS' },
            { name: 'iPad', value: 'iPad', version: 'OS' },
            { name: 'Kindle', value: 'Silk', version: 'Silk' },
            { name: 'Android', value: 'Android', version: 'Android' },
            { name: 'PlayBook', value: 'PlayBook', version: 'OS' },
            { name: 'BlackBerry', value: 'BlackBerry', version: '/' },
            { name: 'Macintosh', value: 'Mac', version: 'OS X' },
            { name: 'Linux', value: 'Linux', version: 'rv' },
            { name: 'Palm', value: 'Palm', version: 'PalmOS' }
        ],
        databrowser: [
            { name: 'Chrome', value: 'Chrome', version: 'Chrome' },
            { name: 'Firefox', value: 'Firefox', version: 'Firefox' },
            { name: 'Safari', value: 'Safari', version: 'Version' },
            { name: 'Internet Explorer', value: 'MSIE', version: 'MSIE' },
            { name: 'Opera', value: 'Opera', version: 'Opera' },
            { name: 'BlackBerry', value: 'CLDC', version: 'CLDC' },
            { name: 'Mozilla', value: 'Mozilla', version: 'Mozilla' }
        ],
        init: function () {
            var agent = this.header.join(' '),
                os = this.matchItem(agent, this.dataos),
                browser = this.matchItem(agent, this.databrowser);
            
            return { os: os, browser: browser };
        },
        matchItem: function (string, data) {
            var i = 0,
                j = 0,
                html = '',
                regex,
                regexv,
                match,
                matches,
                version;
            
            for (i = 0; i < data.length; i += 1) {
                regex = new RegExp(data[i].value, 'i');
                match = regex.test(string);
                if (match) {
                    regexv = new RegExp(data[i].version + '[- /:;]([\\d._]+)', 'i');
                    matches = string.match(regexv);
                    version = '';
                    if (matches) { if (matches[1]) { matches = matches[1]; } }
                    if (matches) {
                        matches = matches.split(/[._]+/);
                        for (j = 0; j < matches.length; j += 1) {
                            if (j === 0) {
                                version += matches[j] + '.';
                            } else {
                                version += matches[j];
                            }
                        }
                    } else {
                        version = '0';
                    }
                    return {
                        name: data[i].name,
                        version: parseFloat(version)
                    };
                }
            }
            return { name: 'unknown', version: 0 };
        }
    };
    
    var e = module.init(),
        debug = '';
	client_data.os_name = e.os.name;
	client_data.os_version = e.os.version;
	client_data.browser_name = e.browser.name;
	client_data.browser_version = e.browser.version;
	client_data.user_agent = navigator.userAgent
	client_data.vendor =  navigator.vendor;
	

	loadConversaton(api_key);
	
	
}());



$.getJSON('http://www.geoplugin.net/json.gp?jsoncallback=?', function(data) {
  
    var geodata = data;

    client_data.user_ip = geodata.geoplugin_request;
  	client_data.user_country = geodata.geoplugin_countryName;
  	client_data.user_state = geodata.geoplugin_countryName;
	client_data.user_city = geodata.geoplugin_city;
	client_data.user_region = geodata.geoplugin_regionName;
	client_data.lat = geodata.geoplugin_latitude;
	client_data.lon = geodata.geoplugin_longitude;
  
  
});


console.log(client_data);
</script>

    <script src="js/fgEmojiPicker.js"></script>
    <script>
        const emojiPicker = new FgEmojiPicker({
            trigger: ['button'],
            position: ['bottom', 'right'],
            preFetch: true,
            insertInto: document.querySelector('textarea'),
            emit(obj, triggerElement) {
                console.log(obj, triggerElement);
            }
        });
    </script>

</body>
</html>
